<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CLAIM TOKEN $GODMODE - FREE MINT</title>
    <script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
    <script type="module">
        import sdk from 'https://esm.sh/@farcaster/frame-sdk@0.1.1';
        window.sdk = sdk;
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #fff;
        }

        .container {
            max-width: 500px;
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo h1 {
            font-size: 48px;
            font-weight: 900;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            margin-bottom: 10px;
        }

        .logo p {
            font-size: 16px;
            opacity: 0.9;
            font-weight: 500;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            padding: 20px;
            border-radius: 16px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-card .label {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-card .value {
            font-size: 24px;
            font-weight: 700;
            color: #ffd700;
        }

        .progress-section {
            margin-bottom: 30px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ffd700, #ffed4e);
            transition: width 0.5s ease;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }

        .mint-section {
            background: rgba(255, 255, 255, 0.1);
            padding: 25px;
            border-radius: 16px;
            margin-bottom: 20px;
        }

        .mint-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .mint-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mint-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .mint-amount {
            font-size: 36px;
            font-weight: 700;
            min-width: 60px;
            text-align: center;
        }

        .mint-info {
            text-align: center;
            margin-bottom: 20px;
        }

        .mint-info p {
            font-size: 14px;
            opacity: 0.9;
            margin: 5px 0;
        }

        .mint-info .highlight {
            color: #ffd700;
            font-weight: 700;
        }

        .connect-btn, .mint-action-btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .connect-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #fff;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .connect-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .mint-action-btn {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        }

        .mint-action-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.6);
        }

        .mint-action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .wallet-info {
            text-align: center;
            margin-bottom: 20px;
            font-size: 14px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
        }

        .status-message {
            text-align: center;
            padding: 15px;
            border-radius: 12px;
            margin-top: 20px;
            font-size: 14px;
            display: none;
        }

        .status-message.success {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.4);
            display: block;
        }

        .status-message.error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid rgba(239, 68, 68, 0.4);
            display: block;
        }

        .status-message.info {
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.4);
            display: block;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .share-btn {
            width: 100%;
            padding: 15px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: transparent;
            color: #fff;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
        }

        .share-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.5);
        }

        @media (max-width: 480px) {
            .container {
                padding: 25px;
            }
            
            .logo h1 {
                font-size: 36px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">
            <h1>$GODMODE</h1>
            <p>FREE MINT ON BASE MAINNET</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="label">Total Supply</div>
                <div class="value">1B</div>
            </div>
            <div class="stat-card">
                <div class="label">Max Per User</div>
                <div class="value">50x</div>
            </div>
            <div class="stat-card">
                <div class="label">Per Mint</div>
                <div class="value">45K</div>
            </div>
            <div class="stat-card">
                <div class="label">Your Mints</div>
                <div class="value" id="userMints">0</div>
            </div>
        </div>

        <div class="progress-section">
            <div class="progress-header">
                <span>Minting Progress</span>
                <span id="progressText">0 / 20,000</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
        </div>

        <div class="mint-section">
            <div class="mint-controls">
                <button class="mint-btn" id="decreaseBtn">âˆ’</button>
                <div class="mint-amount" id="mintAmount">1</div>
                <button class="mint-btn" id="increaseBtn">+</button>
            </div>

            <div class="mint-info">
                <p>Tokens: <span class="highlight" id="tokensAmount">45,000</span></p>
                <p>Cost: <span class="highlight" id="costAmount">0.00012 ETH</span></p>
                <p style="font-size: 12px; opacity: 0.7; margin-top: 10px;">*Small network fee applies</p>
            </div>

            <div id="walletSection">
                <button class="connect-btn" id="connectBtn">
                    ðŸ”— Connect Wallet
                </button>
            </div>

            <div id="mintSection" style="display: none;">
                <div class="wallet-info" id="walletInfo"></div>
                <button class="mint-action-btn" id="mintBtn">
                    ðŸš€ MINT NOW
                </button>
                <button class="share-btn" id="shareBtn" style="display: none;">
                    ðŸ“¢ Share on Farcaster
                </button>
            </div>
        </div>

        <div class="status-message" id="statusMessage"></div>
    </div>

    <script>
        // Contract Configuration
        const CONTRACT_ADDRESS = '0xfe0b0148A535ab66F83e19756A20A0b9fCAF1305';
        const BASE_CHAIN_ID = 8453;
        const TOKENS_PER_MINT = 45000;
        const MINT_PRICE = '0.00012';
        const MAX_MINTS_PER_USER = 50;

        const CONTRACT_ABI = [
            "function mint(uint256 mintCount) external payable",
            "function totalMintCount() external view returns (uint256)",
            "function userMintCount(address) external view returns (uint256)",
            "function remainingMints() external view returns (uint256)",
            "function remainingMintsForUser(address) external view returns (uint256)",
            "function TOTAL_MINTS_AVAILABLE() external view returns (uint256)"
        ];

        let provider = null;
        let signer = null;
        let contract = null;
        let userAddress = null;
        let currentMintAmount = 1;
        let frameSDK = null;

        // Wait for SDK to load
        function waitForSDK() {
            return new Promise((resolve) => {
                const checkSDK = setInterval(() => {
                    if (window.sdk) {
                        clearInterval(checkSDK);
                        resolve(window.sdk);
                    }
                }, 100);
            });
        }

        // Initialize Farcaster SDK
        async function initFarcasterSDK() {
            try {
                frameSDK = await waitForSDK();
                
                // Call ready to signal the frame is ready
                await frameSDK.actions.ready();
                console.log('âœ… Farcaster SDK ready');
                
                // Get context if available
                const context = frameSDK.context;
                if (context) {
                    console.log('Frame context:', context);
                }
                
                showStatus('Farcaster Mini App loaded! Connect your wallet.', 'info');
            } catch (error) {
                console.error('SDK init error:', error);
                // Continue in standalone mode
                showStatus('Running in standalone mode', 'info');
            }
        }

        // Initialize app
        window.addEventListener('load', async () => {
            await initFarcasterSDK();
            await loadContractData();
        });

        // Load contract data
        async function loadContractData() {
            try {
                const baseProvider = new ethers.providers.JsonRpcProvider('https://mainnet.base.org');
                const readContract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, baseProvider);
                
                const totalMints = await readContract.totalMintCount();
                const totalAvailable = await readContract.TOTAL_MINTS_AVAILABLE();
                
                updateProgress(totalMints.toNumber(), totalAvailable.toNumber());
            } catch (error) {
                console.error('Error loading contract data:', error);
            }
        }

        // Connect Wallet
        document.getElementById('connectBtn').addEventListener('click', async () => {
            try {
                let connectedAddress = null;

                // Try Farcaster wallet provider first
                if (frameSDK && frameSDK.wallet) {
                    try {
                        const result = await frameSDK.wallet.ethProvider.request({
                            method: 'eth_requestAccounts'
                        });
                        connectedAddress = result[0];
                        provider = new ethers.providers.Web3Provider(frameSDK.wallet.ethProvider);
                        console.log('âœ… Connected via Farcaster wallet');
                    } catch (e) {
                        console.log('Farcaster wallet not available:', e);
                    }
                }

                // Fallback to regular Web3 provider
                if (!connectedAddress && window.ethereum) {
                    const accounts = await window.ethereum.request({ 
                        method: 'eth_requestAccounts' 
                    });
                    connectedAddress = accounts[0];
                    provider = new ethers.providers.Web3Provider(window.ethereum);

                    const chainId = await window.ethereum.request({ 
                        method: 'eth_chainId' 
                    });

                    // Switch to Base Mainnet if needed
                    if (parseInt(chainId) !== BASE_CHAIN_ID) {
                        try {
                            await window.ethereum.request({
                                method: 'wallet_switchEthereumChain',
                                params: [{ chainId: '0x2105' }],
                            });
                        } catch (switchError) {
                            if (switchError.code === 4902) {
                                await window.ethereum.request({
                                    method: 'wallet_addEthereumChain',
                                    params: [{
                                        chainId: '0x2105',
                                        chainName: 'Base Mainnet',
                                        nativeCurrency: {
                                            name: 'Ethereum',
                                            symbol: 'ETH',
                                            decimals: 18
                                        },
                                        rpcUrls: ['https://mainnet.base.org'],
                                        blockExplorerUrls: ['https://basescan.org']
                                    }]
                                });
                            }
                        }
                    }
                    console.log('âœ… Connected via Web3 provider');
                }

                if (!connectedAddress) {
                    throw new Error('No wallet available. Please use Farcaster app or install a Web3 wallet.');
                }

                signer = provider.getSigner();
                userAddress = connectedAddress;
                contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);

                document.getElementById('walletSection').style.display = 'none';
                document.getElementById('mintSection').style.display = 'block';
                document.getElementById('walletInfo').textContent = 
                    `Connected: ${userAddress.slice(0, 6)}...${userAddress.slice(-4)}`;

                await updateUserMints();
                showStatus('âœ… Wallet connected successfully!', 'success');
            } catch (error) {
                console.error('Connection error:', error);
                showStatus('âŒ ' + error.message, 'error');
            }
        });

        // Mint controls
        document.getElementById('decreaseBtn').addEventListener('click', () => {
            if (currentMintAmount > 1) {
                currentMintAmount--;
                updateMintDisplay();
            }
        });

        document.getElementById('increaseBtn').addEventListener('click', () => {
            if (currentMintAmount < MAX_MINTS_PER_USER) {
                currentMintAmount++;
                updateMintDisplay();
            }
        });

        function updateMintDisplay() {
            document.getElementById('mintAmount').textContent = currentMintAmount;
            document.getElementById('tokensAmount').textContent = 
                (TOKENS_PER_MINT * currentMintAmount).toLocaleString();
            document.getElementById('costAmount').textContent = 
                (parseFloat(MINT_PRICE) * currentMintAmount).toFixed(5) + ' ETH';
        }

        // Mint function
        document.getElementById('mintBtn').addEventListener('click', async () => {
            try {
                const mintBtn = document.getElementById('mintBtn');
                mintBtn.disabled = true;
                mintBtn.innerHTML = '<span class="loading"></span> Minting...';

                const userMints = await contract.userMintCount(userAddress);
                if (userMints.toNumber() + currentMintAmount > MAX_MINTS_PER_USER) {
                    throw new Error('Exceeds maximum mints per user');
                }

                const value = ethers.utils.parseEther(
                    (parseFloat(MINT_PRICE) * currentMintAmount).toString()
                );

                const tx = await contract.mint(currentMintAmount, { value });
                showStatus('â³ Transaction submitted! Waiting for confirmation...', 'info');

                await tx.wait();
                
                showStatus(`ðŸŽ‰ Successfully minted ${(currentMintAmount * TOKENS_PER_MINT).toLocaleString()} $GODMODE tokens!`, 'success');
                
                await updateUserMints();
                await loadContractData();
                
                document.getElementById('shareBtn').style.display = 'block';
                
                mintBtn.disabled = false;
                mintBtn.textContent = 'ðŸš€ MINT NOW';
            } catch (error) {
                console.error('Mint error:', error);
                showStatus('âŒ Mint failed: ' + (error.message || 'Unknown error'), 'error');
                
                const mintBtn = document.getElementById('mintBtn');
                mintBtn.disabled = false;
                mintBtn.textContent = 'ðŸš€ MINT NOW';
            }
        });

        // Share on Farcaster
        document.getElementById('shareBtn').addEventListener('click', () => {
            const text = encodeURIComponent(
                `Just minted ${(currentMintAmount * TOKENS_PER_MINT).toLocaleString()} $GODMODE tokens! ðŸš€\n\nJoin the FREE MINT now on Base Mainnet!`
            );
            const url = encodeURIComponent('https://claim-token-godmode.vercel.app/');
            const castUrl = `https://warpcast.com/~/compose?text=${text}&embeds[]=${url}`;
            
            // Use Farcaster SDK if available
            if (frameSDK && frameSDK.actions && frameSDK.actions.openUrl) {
                frameSDK.actions.openUrl(castUrl);
            } else {
                window.open(castUrl, '_blank');
            }
        });

        async function updateUserMints() {
            if (contract && userAddress) {
                try {
                    const mints = await contract.userMintCount(userAddress);
                    document.getElementById('userMints').textContent = mints.toNumber();
                } catch (error) {
                    console.error('Error updating user mints:', error);
                }
            }
        }

        function updateProgress(current, total) {
            const percentage = (current / total) * 100;
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressText').textContent = 
                `${current.toLocaleString()} / ${total.toLocaleString()}`;
        }

        function showStatus(message, type) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = 'status-message ' + type;
            
            if (type === 'success' || type === 'error') {
                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, 5000);
            }
        }
    </script>
</body>
</html>
