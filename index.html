<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CLAIM TOKEN $GODMODE â€” FREE MINT (Farcaster)</title>

  <!-- Farcaster Frame metadata (vNext) -->
  <meta property="fc:frame" content="vNext">
  <!-- replace with a hosted 1200x1200 png for best Warpcast preview -->
  <meta property="fc:frame:image" content="https://claim-token-godmode.vercel.app/frame.png">
  <meta property="fc:frame:image:aspect_ratio" content="1:1">

  <!-- Frame Buttons - warpcast will surface these as buttons -->
  <meta property="fc:frame:button:1" content="Mint 1x (0.00012 ETH)">
  <meta property="fc:frame:button:1:action" content="tx">
  <meta property="fc:frame:button:1:target" content="https://claim-token-godmode.vercel.app/api/tx/1">
  <meta property="fc:frame:button:1:post_url" content="https://claim-token-godmode.vercel.app/api/success">

  <meta property="fc:frame:button:2" content="Mint 5x (0.0006 ETH)">
  <meta property="fc:frame:button:2:action" content="tx">
  <meta property="fc:frame:button:2:target" content="https://claim-token-godmode.vercel.app/api/tx/5">
  <meta property="fc:frame:button:2:post_url" content="https://claim-token-godmode.vercel.app/api/success">

  <meta property="fc:frame:button:3" content="Mint 10x (0.0012 ETH)">
  <meta property="fc:frame:button:3:action" content="tx">
  <meta property="fc:frame:button:3:target" content="https://claim-token-godmode.vercel.app/api/tx/10">
  <meta property="fc:frame:button:3:post_url" content="https://claim-token-godmode.vercel.app/api/success">

  <meta property="fc:frame:button:4" content="View Site">
  <meta property="fc:frame:button:4:action" content="link">
  <meta property="fc:frame:button:4:target" content="https://claim-token-godmode.vercel.app/">

  <!-- Open Graph -->
  <meta property="og:title" content="CLAIM TOKEN $GODMODE â€” FREE MINT">
  <meta property="og:description" content="Exclusive for Farcaster users â€” Max 50x per user â€¢ Total Supply 1B. Slight fee applies but it's a free mint for Farcaster.">
  <meta property="og:image" content="https://claim-token-godmode.vercel.app/frame.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="1200">

  <!-- Ethers.js (for wallet & contract interaction) -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@6.9.0/dist/ethers.umd.min.js" defer></script>

  <style>
    :root{
      --glass: rgba(255,255,255,0.06);
      --muted: rgba(255,255,255,0.85);
      --accent1: #ffd700;
      --accent2: #ffed4e;
      --bg1: #0f172a;
      --bg2: #2b1055;
    }
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;}
    body{
      background: linear-gradient(135deg,var(--bg1),var(--bg2));
      color: #fff;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .card{
      width:100%;
      max-width:920px;
      border-radius:20px;
      padding:28px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.5);
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.06);
      backdrop-filter: blur(8px);
      display:grid;
      grid-template-columns: 380px 1fr;
      gap:24px;
    }
    .left{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:18px;
      padding:10px;
    }
    .hero {
      width:220px;height:220px;border-radius:18px;display:flex;align-items:center;justify-content:center;
      background: linear-gradient(135deg,#2b1055,#4c02a4);
      border: 1px solid rgba(255,255,255,0.06);
      box-shadow: inset 0 -8px 40px rgba(0,0,0,0.25);
    }
    .hero svg{width:140px;height:140px;filter:drop-shadow(0 8px 20px rgba(0,0,0,0.5));}
    h1{font-size:22px;margin:0;letter-spacing:0.6px;font-weight:800;background:linear-gradient(90deg,#fff,#ffd700);-webkit-background-clip:text;color:transparent}
    .sub{color:var(--muted);font-size:13px;margin-top:6px;text-align:center;}
    .statbox{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;}
    .stat{background:var(--glass);padding:10px 14px;border-radius:12px;font-weight:700;font-size:13px;border:1px solid rgba(255,255,255,0.03);}
    .right{display:flex;flex-direction:column;gap:14px;padding:6px}
    .progress-wrap{background:rgba(0,0,0,0.2);padding:12px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    .progress-header{display:flex;justify-content:space-between;align-items:center;font-size:13px;color:var(--muted);margin-bottom:8px}
    .progress-bar{width:100%;height:20px;background:rgba(255,255,255,0.06);border-radius:999px;overflow:hidden;border:1px solid rgba(255,255,255,0.03)}
    .progress-fill{height:100%;width:0%;background:linear-gradient(90deg,var(--accent1),var(--accent2));display:flex;align-items:center;justify-content:flex-end;padding-right:10px;font-weight:700;color:#111}
    .mint-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .mint-btn{padding:14px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));border:1px solid rgba(255,255,255,0.05);cursor:pointer;font-weight:800}
    .mint-btn:active{transform:translateY(1px)}
    .cta{padding:14px;border-radius:12px;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:#111;font-weight:900;border:none;cursor:pointer}
    .info{font-size:13px;color:var(--muted);display:flex;gap:12px;flex-direction:column}
    .small{font-size:12px;color:var(--muted)}
    .row{display:flex;justify-content:space-between;align-items:center}
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:28px;background:#0b1220;padding:12px 18px;border-radius:12px;border:1px solid rgba(255,255,255,0.04);box-shadow:0 8px 30px rgba(0,0,0,0.6);display:none;color:white;font-weight:700}
    @media (max-width:880px){.card{grid-template-columns:1fr;}}
  </style>
</head>
<body>
  <div class="card" role="main">
    <div class="left">
      <div class="hero" aria-hidden="true">
        <!-- Embedded SVG hero (also serves as image) -->
        <svg viewBox="0 0 120 120" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="$GODMODE">
          <defs>
            <linearGradient id="g" x1="0" x2="1" y1="0" y2="1">
              <stop offset="0" stop-color="#fff100"/>
              <stop offset="1" stop-color="#ff7ab6"/>
            </linearGradient>
          </defs>
          <rect rx="20" width="120" height="120" fill="#0b0226"/>
          <g transform="translate(12,10)">
            <path d="M36 6L16 36h44L36 6z" fill="url(#g)" stroke="#fff" stroke-width="2" stroke-linejoin="round"/>
            <circle cx="76" cy="76" r="18" fill="rgba(255,255,255,0.06)"/>
            <text x="70" y="82" font-size="14" font-weight="900" fill="#fff" text-anchor="middle">$</text>
          </g>
        </svg>
      </div>

      <h1>CLAIM TOKEN $GODMODE â€” FREE MINT</h1>
      <div class="sub">Exclusive for Farcaster users â€” Base Mainnet â€¢ Max 50x per user â€¢ Total supply 1B</div>

      <div class="statbox" aria-hidden="true">
        <div class="stat">Per Mint: 45,000 tokens</div>
        <div class="stat">Mint Price: 0.00012 ETH</div>
        <div class="stat">Total Mints: 20,000</div>
      </div>

      <div style="width:100%;margin-top:8px;text-align:center">
        <button id="connectBtn" class="mint-btn" style="width:100%">Connect Wallet (Farcaster / Base)</button>
      </div>
    </div>

    <div class="right">
      <div class="progress-wrap" aria-live="polite">
        <div class="progress-header">
          <div>Minting Progress</div>
          <div id="progressText">â€” / 20,000</div>
        </div>
        <div class="progress-bar" role="progressbar" aria-valuemin="0" aria-valuemax="100">
          <div id="progressFill" class="progress-fill">0%</div>
        </div>
        <div class="small" style="margin-top:8px" id="remainingText">Loading on-chain supplyâ€¦</div>
      </div>

      <div style="display:flex;gap:12px">
        <div style="flex:1">
          <div style="font-size:13px;margin-bottom:8px;color:var(--muted)">Choose amount</div>
          <div class="mint-grid">
            <button class="mint-btn" data-amount="1">1x â€” 45,000</button>
            <button class="mint-btn" data-amount="5">5x â€” 225,000</button>
            <button class="mint-btn" data-amount="10">10x â€” 450,000</button>
            <button class="mint-btn" data-amount="50">50x â€” 2,250,000</button>
          </div>
        </div>

        <div style="width:220px;display:flex;flex-direction:column;gap:8px">
          <div style="font-size:13px;color:var(--muted)">Quick Actions</div>
          <button id="mintNow" class="cta" style="width:100%">Mint Selected</button>
          <button id="autocast" class="mint-btn" style="width:100%">Autocast Toggle: ON</button>
        </div>
      </div>

      <div class="info" style="margin-top:8px">
        <div class="row"><div class="small">Contract</div><div class="small" style="font-family:monospace">0xfe0b...1305</div></div>
        <div class="row"><div class="small">Network</div><div class="small">Base Mainnet</div></div>
        <div class="row"><div class="small">Max per user</div><div class="small">50x</div></div>
        <div class="row"><div class="small">Total Supply</div><div class="small">1,000,000,000</div></div>
      </div>
    </div>
  </div>

  <div id="toast" class="toast" role="status"></div>

  <script>
    // Config
    const CONTRACT_ADDRESS = "0xfe0b0148A535ab66F83e19756A20A0b9fCAF1305";
    const MINT_PRICE_ETH = "0.00012"; // per mint
    const TOTAL_MINTS_AVAILABLE = 20000;
    const MAX_MINTS_PER_USER = 50;

    // Minimal ABI (only what we need)
    const ABI = [
      "function mint(uint256 mintCount) payable",
      "function remainingMints() view returns (uint256)",
      "function remainingMintsForUser(address user) view returns (uint256)",
      "function totalMinted() view returns (uint256)",
      "event TokensMinted(address indexed user, uint256 amount, uint256 mintNumber)"
    ];

    let provider, signer, contract;
    let selectedAmount = 1;
    let autocastOn = true;

    const connectBtn = document.getElementById("connectBtn");
    const toast = document.getElementById("toast");
    const progressFill = document.getElementById("progressFill");
    const progressText = document.getElementById("progressText");
    const remainingText = document.getElementById("remainingText");

    function showToast(msg, ms = 4000) {
      toast.textContent = msg;
      toast.style.display = "block";
      setTimeout(()=>toast.style.display="none", ms);
    }

    // Connect wallet (MetaMask / Base wallet or other injected provider)
    async function connectWallet() {
      if (!window.ethereum) {
        showToast("No injected wallet found. Use a Base-compatible wallet.");
        return;
      }
      try {
        provider = new ethers.BrowserProvider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = await provider.getSigner();
        contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
        const addr = await signer.getAddress();
        connectBtn.textContent = "Connected: " + addr.slice(0,6) + "â€¦" + addr.slice(-4);
        showToast("Wallet connected");
        // initial load of on-chain state
        refreshProgress();
      } catch(e) {
        console.error(e);
        showToast("Connection rejected or failed");
      }
    }

    // Read remaining mints on-chain and update progress bar
    async function refreshProgress() {
      try {
        const rpcProvider = provider || new ethers.JsonRpcProvider(); // fallback provider if not connected
        const readContract = new ethers.Contract(CONTRACT_ADDRESS, ABI, rpcProvider);
        const rem = await readContract.remainingMints();
        // remainingMints returns uint => Mints left
        const remaining = Number(rem.toString ? rem.toString() : rem);
        const minted = TOTAL_MINTS_AVAILABLE - remaining;
        const pct = Math.min(100, Math.round((minted / TOTAL_MINTS_AVAILABLE) * 100));
        progressFill.style.width = pct + "%";
        progressFill.textContent = pct + "%";
        progressText.textContent = `${minted.toLocaleString()} / ${TOTAL_MINTS_AVAILABLE.toLocaleString()}`;
        remainingText.textContent = `${remaining.toLocaleString()} mints remaining`;
      } catch (err) {
        console.warn("refreshProgress err", err);
        remainingText.textContent = "Unable to read on-chain progress";
      }
    }

    // Build and send mint tx
    async function mint(mintCount) {
      if (!signer || !contract) {
        showToast("Please connect your wallet first");
        return;
      }
      if (mintCount <= 0) return;
      if (mintCount > MAX_MINTS_PER_USER) {
        showToast("Mint count exceeds per-user limit");
        return;
      }
      showToast(`Preparing ${mintCount}x mint...`);
      try {
        // calculate value
        const pricePer = ethers.parseEther(MINT_PRICE_ETH);
        const value = pricePer * BigInt(mintCount);
        // send tx
        const tx = await contract.mint(BigInt(mintCount), { value });
        showToast("Transaction sent â€” awaiting confirmation...");
        const receipt = await tx.wait();
        showToast("Mint confirmed! ðŸŽ‰");

        // Update UI
        await refreshProgress();

        // autocast: open Warpcast compose to share success (user must complete post)
        if (autocastOn) {
          const addr = await signer.getAddress();
          const text = encodeURIComponent(`I just claimed $GODMODE (${mintCount}x) on Base! Contract: ${CONTRACT_ADDRESS}`);
          // open Warpcast compose in new tab â€” users sign/post in Warpcast
          window.open(`https://warpcast.com/~/compose?text=${text}&embeds[]=${encodeURIComponent(location.href)}`, "_blank");
        }
      } catch (e) {
        console.error(e);
        const msg = (e && e.error && e.error.message) || e.message || "Transaction failed or rejected";
        showToast("Error: " + msg);
      }
    }

    // UI interactions
    document.querySelectorAll(".mint-btn[data-amount]").forEach(btn=>{
      btn.addEventListener("click", (ev)=>{
        selectedAmount = Number(btn.dataset.amount);
        document.querySelectorAll(".mint-btn[data-amount]").forEach(b=>b.style.outline = "none");
        btn.style.outline = "3px solid rgba(255,215,0,0.18)";
        showToast(`Selected ${selectedAmount}x`);
      });
    });

    document.getElementById("mintNow").addEventListener("click", async ()=>{
      // Confirm wallet connected
      if (!signer) {
        await connectWallet();
        if(!signer) return;
      }
      // call mint
      await mint(selectedAmount);
    });

    connectBtn.addEventListener("click", connectWallet);
    document.getElementById("autocast").addEventListener("click", ()=>{
      autocastOn = !autocastOn;
      document.getElementById("autocast").textContent = "Autocast Toggle: " + (autocastOn ? "ON" : "OFF");
      showToast("Autocast " + (autocastOn ? "enabled" : "disabled"));
    });

    // initial selected outline
    document.querySelector('.mint-btn[data-amount="1"]').style.outline = "3px solid rgba(255,215,0,0.18)";
    // periodically refresh progress
    refreshProgress();
    setInterval(refreshProgress, 12_000);

    // Accessibility: announce if inside farcaster iframe? Not reliable â€”
    // rely on fc:frame metadata for Warpcast to produce native buttons.
  </script>
</body>
</html>
